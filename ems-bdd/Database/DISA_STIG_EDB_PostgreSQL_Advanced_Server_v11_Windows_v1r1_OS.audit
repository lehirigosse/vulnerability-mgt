#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2020/10/01 $
#
# Description : This document implements the security configuration as recommended by the
#               DISA EDB Postgres Advanced Server v11 on Windows v1r1 STIG.
#
#<ui_metadata>
#<display_name>EDB PostgreSQL Advanced Server v11 Windows OS Audit v1r1</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>EDB PostgreSQL Advanced Server v11 Windows OS</name>
#  <version>1.1.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip</link>
#</spec>
#<labels>windows,disa,edb,postgresql,advanced,server</labels>
#<benchmark_refs>CAT,CCI,Rule-ID,STIG-ID,Vuln-ID</benchmark_refs>
#<variables>
#  <variable>
#    <name>PG_DATA_DIR</name>
#    <default>C:\Program Files\edb\as11\data</default>
#    <description>PostgreSQL Data directory</description>
#    <info>Data directory where PostgreSQL configuration files are commonly found.</info>
#  </variable>
#  <variable>
#    <name>PG_USER</name>
#    <default>enterprisedb</default>
#    <description>PostgreSQL User</description>
#    <info>User account that PostgreSQL processes are run as and date is owned by.</info>
#  </variable>
#  <variable>
#    <name>APP_DATA</name>
#    <default>C:\Users\Administrator\AppData</default>
#    <description>Application Data Directory</description>
#    <info>Application Data subdirectory in the user's profile.</info>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Windows" version:"2">
<group_policy:"DISA STIG EDB PostgreSQL Advanced Server v11 Windows OS Audit">

<custom_item>
  type        : FILE_CONTENT_CHECK_NOT
  description : "EP11-00-000700 - The EDB Postgres Advanced Server must integrate with an organization-level authentication/access mechanism providing account management and automation for all users, groups, roles, and any other principals."
  info        : "Enterprise environments make account management for applications and databases challenging and complex. A manual process for account management functions adds the risk of a potential oversight or other error. Managing accounts for the same person in multiple places is inefficient and prone to problems with consistency and synchronization.

A comprehensive application account management process that includes automation helps to ensure that accounts designated as requiring attention are consistently and promptly addressed.

Examples include, but are not limited to, using automation to take action on multiple accounts designated as inactive, suspended, or terminated, or by disabling accounts located in non-centralized account stores, such as multiple servers. Account management functions can also include: assignment of group or role membership; identifying account type; specifying user access authorizations (i.e., privileges); account removal, update, or termination; and administrative alerts. The use of automated mechanisms can include, for example: using email or text messaging to notify account managers when users are terminated or transferred; using the information system to monitor account usage; and using automated telephone notification to report atypical system account usage.

The EDB Postgres Advanced Server must be configured to automatically utilize organization-level account management functions, and these functions must immediately enforce the organization's current account policy.

Automation may be comprised of differing technologies that when placed together contain an overall mechanism supporting an organization's automated account management requirements.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Identify any user using 'trust', 'sha-256-scram', md5', 'ident', 'peer' or 'password' as allowable access methods.

To identify users in the pg_hba.conf file using the methods listed above, open the pg_hba.conf file in a text editor, and inspect the contents of the file, looking for uncommented lines with these methods. Optionally, the following command can be run from a Windows command prompt to identify any uncommented lines in the pg_hba.conf file that may be using these methods:

 type <postgresql pg_hba.conf directory>\pg_hba.conf | findstr /N 'scram-sha-256 md5 trust password peer ident' | find /V /N '#'

Note: If the path to the pg_hba.conf file contains spaces in it, the path to the file (including the file name) should be placed in double quotes.

Document any rows that have 'trust', 'sha-256-scram', 'md5', 'ident', 'peer', or 'password' specified for the 'METHOD' column and obtain appropriate approval for each user specified in the 'USER' column (i.e., all DBMS managed accounts).

For any users not documented and approved as DBMS managed accounts, change the 'METHOD' column to one of the externally managed (not 'trust', 'sha-256-scram', 'md5', 'ident', 'peer' or 'password') options defined here:

https://www.postgresql.org/docs/current/static/auth-methods.html"
  reference   : "800-171|3.1.1,800-53|AC-3,CAT|II,CCI|CCI-000015,CN-L3|8.1.10.2(c),CN-L3|8.1.4.11(b),CN-L3|8.1.4.2(f),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,Rule-ID|SV-109393r1_rule,STIG-ID|EP11-00-000700,TBA-FIISB|31.1,Vuln-ID|V-100289"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*[^#]*[\s]*(trust|md5|scram-sha-256|password|peer|ident)([\s]|$)"
  expect      : "^[\s]*[^#]*[\s]*(trust|md5|scram-sha-256|password|peer|ident)([\s]|$)"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-001100 - The EDB Postgres Advanced Server must allow only the ISSM (or individuals or roles appointed by the ISSM) to select which auditable events are to be audited. - data dir"
  info            : "Without the capability to restrict the types of roles and individuals that can select which events are audited, unauthorized personnel may be able to prevent or interfere with the auditing of critical events.

Suppression of auditing could permit an adversary to evade detection.

Misconfigured audits can degrade the system's performance by overwhelming the audit log. Misconfigured audits may also make it more difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "If a non-EDB provided database auditing solution or a custom auditing solution is being used, configure the DBMS's settings according to the documentation provided for those solutions to allow designated personnel to select which auditable events are audited.

If EDB Auditing is being used, perform the following actions as necessary to address any findings:
1) Postgresql Data Directory Ownership and Permissions:
If the postgresql data directory and its contents are owned by unauthorized users, change ownership to an authorized user.

Restrict access on the postgresql data directory to the database service account, software owner accounts, Administrators, DBAs, System group, or other documented users authorized to start a postgresql database cluster.

2) Postgresql Configuration File Ownership and Permissions:
If the postgresql configuration file(s) is owned by an unauthorized user, change ownership to an authorized user.

Restrict write access on Postgres configuration file(s) the database service account, software owner accounts, Administrators, DBAs, System group, or other documented users authorized to edit the file(s).

3) Database Users Assigned Superuser Privileges:
Remove superuser rights from unauthorized database users via the ALTER ROLE or ALTER USER SQL command.

The syntax is:
ALTER ROLE <role> NOSUPERUSER

or

ALTER USER <user> NOSUPERUSER

Example:
ALTER ROLE testuser NOSUPERUSER;

OR

ALTER USER testuser NOSUPERUSER;

See PostgreSQL and/or EDB Postgres Advanced Server documentation for details."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000171,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109401r1_rule,STIG-ID|EP11-00-001100,SWIFT-CSCv1|2.3,Vuln-ID|V-100297"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "ManualReviewRequired"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "$f='C:\\Program Files\\edb\\as11\\data';icacls $f;"
  check_type      : CHECK_REGEX
  severity        : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-001100 - The EDB Postgres Advanced Server must allow only the ISSM (or individuals or roles appointed by the ISSM) to select which auditable events are to be audited. - data\*"
  info            : "Without the capability to restrict the types of roles and individuals that can select which events are audited, unauthorized personnel may be able to prevent or interfere with the auditing of critical events.

Suppression of auditing could permit an adversary to evade detection.

Misconfigured audits can degrade the system's performance by overwhelming the audit log. Misconfigured audits may also make it more difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "If a non-EDB provided database auditing solution or a custom auditing solution is being used, configure the DBMS's settings according to the documentation provided for those solutions to allow designated personnel to select which auditable events are audited.

If EDB Auditing is being used, perform the following actions as necessary to address any findings:
1) Postgresql Data Directory Ownership and Permissions:
If the postgresql data directory and its contents are owned by unauthorized users, change ownership to an authorized user.

Restrict access on the postgresql data directory to the database service account, software owner accounts, Administrators, DBAs, System group, or other documented users authorized to start a postgresql database cluster.

2) Postgresql Configuration File Ownership and Permissions:
If the postgresql configuration file(s) is owned by an unauthorized user, change ownership to an authorized user.

Restrict write access on Postgres configuration file(s) the database service account, software owner accounts, Administrators, DBAs, System group, or other documented users authorized to edit the file(s).

3) Database Users Assigned Superuser Privileges:
Remove superuser rights from unauthorized database users via the ALTER ROLE or ALTER USER SQL command.

The syntax is:
ALTER ROLE <role> NOSUPERUSER

or

ALTER USER <user> NOSUPERUSER

Example:
ALTER ROLE testuser NOSUPERUSER;

OR

ALTER USER testuser NOSUPERUSER;

See PostgreSQL and/or EDB Postgres Advanced Server documentation for details."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000171,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109401r1_rule,STIG-ID|EP11-00-001100,SWIFT-CSCv1|2.3,Vuln-ID|V-100297"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "ManualReviewRequired"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "$f='C:\\Program Files\\edb\\as11\\data\*';icacls $f;"
  check_type      : CHECK_REGEX
  severity        : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-001100 - The EDB Postgres Advanced Server must allow only the ISSM (or individuals or roles appointed by the ISSM) to select which auditable events are to be audited. - postgresql.conf"
  info            : "Without the capability to restrict the types of roles and individuals that can select which events are audited, unauthorized personnel may be able to prevent or interfere with the auditing of critical events.

Suppression of auditing could permit an adversary to evade detection.

Misconfigured audits can degrade the system's performance by overwhelming the audit log. Misconfigured audits may also make it more difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "If a non-EDB provided database auditing solution or a custom auditing solution is being used, configure the DBMS's settings according to the documentation provided for those solutions to allow designated personnel to select which auditable events are audited.

If EDB Auditing is being used, perform the following actions as necessary to address any findings:
1) Postgresql Data Directory Ownership and Permissions:
If the postgresql data directory and its contents are owned by unauthorized users, change ownership to an authorized user.

Restrict access on the postgresql data directory to the database service account, software owner accounts, Administrators, DBAs, System group, or other documented users authorized to start a postgresql database cluster.

2) Postgresql Configuration File Ownership and Permissions:
If the postgresql configuration file(s) is owned by an unauthorized user, change ownership to an authorized user.

Restrict write access on Postgres configuration file(s) the database service account, software owner accounts, Administrators, DBAs, System group, or other documented users authorized to edit the file(s).

3) Database Users Assigned Superuser Privileges:
Remove superuser rights from unauthorized database users via the ALTER ROLE or ALTER USER SQL command.

The syntax is:
ALTER ROLE <role> NOSUPERUSER

or

ALTER USER <user> NOSUPERUSER

Example:
ALTER ROLE testuser NOSUPERUSER;

OR

ALTER USER testuser NOSUPERUSER;

See PostgreSQL and/or EDB Postgres Advanced Server documentation for details."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000171,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109401r1_rule,STIG-ID|EP11-00-001100,SWIFT-CSCv1|2.3,Vuln-ID|V-100297"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "ManualReviewRequired"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "$f='C:\\Program Files\\edb\\as11\\data\postgresql.conf';icacls $f;"
  check_type      : CHECK_REGEX
  severity        : MEDIUM
</custom_item>

<report type:"WARNING">
  description : "EP11-00-002300 - The EDB Postgres Advanced Server must by default shut down upon audit failure, to include the unavailability of space for more audit log records; or must be configurable to shut down upon audit failure."
  info        : "It is critical that when the DBMS is at risk of failing to process audit logs as required, action be taken to mitigate the failure. Audit processing failures include: software/hardware errors; failures in the audit capturing mechanisms; and audit storage capacity being reached or exceeded. Responses to audit failure depend upon the nature of the failure mode.

When the need for system availability does not outweigh the need for a complete audit trail, the DBMS should shut down immediately, rolling back all in-flight transactions.

Systems where audit trail completeness is paramount will most likely be at a lower MAC level than MAC I; the final determination is the prerogative of the application owner, subject to Authorizing Official concurrence. In any case, sufficient auditing resources must be allocated to avoid a shutdown in all but the most extreme situations.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Modify DBMS, OS, or third-party logging application settings to alert appropriate personnel when a specific percentage of log storage capacity is reached.

If EDB Postgres Enterprise Manager (PEM) is in use, it may be configured to issue an alert, send an email to designated personnel, and shut down the EDB Postgres Advanced Server instance when the audit log mount point is at 99 percent full. Refer to the Supplemental Procedures document, supplied with this STIG, for guidance on configuring PEM alerts."
  reference   : "CAT|II,CCI|CCI-000140,Rule-ID|SV-109423r1_rule,STIG-ID|EP11-00-002300,Vuln-ID|V-100319"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<report type:"WARNING">
  description : "EP11-00-002400 - The EDB Postgres Advanced Server must be configurable to overwrite audit log records, oldest first (First-In-First-Out - FIFO), in the event of unavailability of space for more audit log records."
  info        : "It is critical that when the DBMS is at risk of failing to process audit logs as required, action be taken to mitigate the failure. Audit processing failures include: software/hardware errors; failures in the audit capturing mechanisms; and audit storage capacity being reached or exceeded. Responses to audit failure depend upon the nature of the failure mode.

When availability is an overriding concern, approved actions in response to an audit failure are as follows:

(i) If the failure was caused by the lack of audit record storage capacity, the DBMS must continue generating audit records, if possible (automatically restarting the audit service if necessary), and overwriting the oldest audit records in a first-in-first-out manner.

(ii) If audit records are sent to a centralized collection server and communication with this server is lost or the server fails, the DBMS must queue audit records locally until communication is restored or until the audit records are retrieved manually. Upon restoration of the connection to the centralized collection server, action should be taken to synchronize the local audit data with the collection server.

Systems where availability is paramount will most likely be MAC I; the final determination is the prerogative of the application owner, subject to Authorizing Official concurrence. In any case, sufficient auditing resources must be allocated to avoid audit data loss in all but the most extreme situations.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Establish a process with accompanying tools for monitoring available disk space and ensuring that sufficient disk space is maintained in order to continue generating audit logs, overwriting the oldest existing records if necessary.

If the organization does not employ an existing log management utility, the following example identifies one approach that may be followed to rotate EDB audit log files on Windows.

Determine the maximum size of the audit log directory. For this example fix, assume the audit log directory must have a maximum size of 100MB. Divide the maximum size of the directory by 10 to determine the size of the log files for rotation. For this example, the audit log file size will be set to 10Mb. Perform the following steps to ensure that the audit log directory is never more than 90% full and the oldest logs are removed to make room for new logs:

1) Execute the following SQL statements to review current auditing related settings and to configure EPAS to generate a new audit log file when the current log file has reached the log file size determined above (10 Mb):

 -- List current EDB Audit settings
 SELECT name, setting FROM pg_settings WHERE category LIKE 'EnterpriseDB Audit%' ORDER BY name;

 /*
 * Note: If edb_audit is not set to 'csv' or 'xml', auditing is not enabled.
 * To enable EDB auditing, issue one of the following SQL statements:
 *
 * ALTER SYSTEM SET edb_audit TO 'xml';
 *
 * or
 *
 * ALTER SYSTEM SET edb_audit TO 'csv';
 *
 */

 -- Set edb_audit_filename parameter to ensure unique name for each log file that is generated
 ALTER SYSTEM SET edb_audit_filename TO 'audit-%Y%m%d_%H%M%S';

 -- Set edb_audit_rotation_size to desired maximum file size (e.g., 10 Mb)
 ALTER SYSTEM SET edb_audit_rotation_size TO 10;

 -- Reload configuration settings to put the updated settings into effect
 SELECT pg_reload_conf();

 -- List current EDB Audit settings to confirm updates are in place
 SELECT name, setting FROM pg_settings WHERE category LIKE 'EnterpriseDB Audit%' ORDER BY name;

2) Using a text editor, create a Windows batch file with the following content:

 @ECHO OFF
 SETLOCAL
 SET 'targetdir=<Path to edb_audit Directory>'
 SET /a retain=8

 FOR /f 'skip=%retain%delims=' %%a IN (
 'dir /b /a-d /o-d '%targetdir%\audit-????????_??????.xml' '
 ) DO DEL '%targetdir%\%%a'

 GOTO :EOF

3) Replace '<Path to edb_audit Directory>' for 'targetdir' variable in the batch file (3rd line) to correspond to the EDB audit log directory configured for your EPAS instance. Note that the EDB audit log directory is configured by the edb_audit_directory parameter. By default, the edb_audit_directory is set to 'edb_audit', which results in an 'edb_audit' directory being created under the EPAS cluster's data directory for audit logs if auditing is enabled. The location of the data directory for a running postgres instance can be found using the following command run from a Windows command prompt:

 psql -d <database name> -U <database superuser name> -c 'SHOW data_directory'

where, <database name> is any database in the EDB postgres instance and <database superuser name> is a database superuser. By default, a database named 'edb' and a superuser named 'enterprisedb' are installed with EDB Postgres Advanced Server (EPAS).

If default setting of 'edb_audit' is used for the edb_audit_directory parameter, the path to the EDB audit directory would be <EDB Postgres data directory>\edb_audit.

4) Update the 'retain' variable in the batch file (4th line) to correspond to the desired minimum number of audit log files that should be retained in the directory. It should be set so that sufficient headroom is maintained in the directory for log files generated between runs of the batch file.

5) Save the batch file to a location that would be accessible to the Windows Task Scheduler. For this example, save the file to 'C:\Windows\System32\Manage_EDB_Audit_Logs.bat'.

6) Using the Windows Task Scheduler, create a scheduled task to execute the Manage_EDB_Audit_Logs.bat file on a periodic basis. At a minimum, it is recommended that the task be scheduled to perform this action at least on an hourly basis. Depending on the various audit log settings and database activity, it may be necessary to configure the task to be run more frequently."
  reference   : "CAT|I,CCI|CCI-000140,Rule-ID|SV-109425r1_rule,STIG-ID|EP11-00-002400,Vuln-ID|V-100321"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-002600 - The audit information produced by the EDB Postgres Advanced Server must be protected from unauthorized read access."
  info            : "If audit data were to become compromised, then competent forensic analysis and discovery of the true source of potentially malicious system activity is difficult, if not impossible, to achieve. In addition, access to audit records provides information an attacker could potentially use to his or her advantage.

To ensure the veracity of audit data, the information system and/or the application must protect audit information from any and all unauthorized access. This includes read, write, copy, etc.

This requirement can be achieved through multiple methods which will depend upon system architecture and design. Some commonly employed methods include ensuring log files enjoy the proper file system permissions utilizing file system protections and limiting log data location.

Additionally, applications with user interfaces to audit records should not allow for the unfettered manipulation of or access to those records via the application. If the application provides access to the audit data, the application becomes accountable for ensuring that audit information is protected from unauthorized access.

Audit information includes all information (e.g., audit records, audit settings, and audit reports) needed to successfully audit information system activity."
  solution        : "1) Change ownership of EDB Audit directory and its contents to the database service account if they are not owned by the database service account.

If the EDB Audit directory and its contents are not owned by the database service account, change ownership to the service account responsible for running the Advanced Server database service.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', select the 'Securities' tab, and select the 'Advanced' button.
 Select the 'Change' link shown next to the owner of the folder to change the folder's owner.

Alternatively, the Windows TAKEOWN command or the ICACLS command (with the /SETOWNER option) may be used to change ownership of folders and files using the Windows command prompt.

2) Modify permissions on the EDB Audit directory and its contents to meet the requirement to protect against unauthorized access.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', and select the 'Security' tab.
 Modify the security permissions to:
 NT AUTHORITY/NetworkService (or configured database service account) (Full Control)
 Administrators (Read)
 Users (none)

Alternatively, the Windows ICACLS command may be used to modify permissions on folders and files using the Windows command prompt.

If other permissions have been granted to other users or groups, ensure that the system documentation is updated to note the organizationally approved permission setting and corresponding justification of the permission settings for this requirement."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000162,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109427r1_rule,STIG-ID|EP11-00-002600,SWIFT-CSCv1|2.3,Vuln-ID|V-100323"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data\edb_audit\' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-002700 - The audit information produced by the EDB Postgres Advanced Server must be protected from unauthorized modification."
  info            : "If audit data were to become compromised, then competent forensic analysis and discovery of the true source of potentially malicious system activity is impossible to achieve.

To ensure the veracity of audit data, the information system and/or the application must protect audit information from unauthorized modification.

This requirement can be achieved through multiple methods that will depend upon system architecture and design. Some commonly employed methods include ensuring log files enjoy the proper file system permissions and limiting log data locations.

Applications providing a user interface to audit data will leverage user permissions and roles identifying the user accessing the data and the corresponding rights that the user enjoys in order to make access decisions regarding the modification of audit data.

Audit information includes all information (e.g., audit records, audit settings, and audit reports) needed to successfully audit information system activity.

Modification of database audit data could mask the theft of, or the unauthorized modification of, sensitive data stored in the database."
  solution        : "1) Change ownership of EDB Audit directory and its contents to the database service account if they are not owned by the database service account.

If the EDB Audit directory and its contents are not owned by the database service account, change ownership to the service account responsible for running the Advanced Server database service.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', select the 'Securities' tab, and select the 'Advanced' button.
 Select the 'Change' link shown next to the owner of the folder to change the folder's owner.

Alternatively, the Windows TAKEOWN command or the ICACLS command (with the /SETOWNER option) may be used to change ownership of folders and files using the Windows command prompt.

2) Modify permissions on the EDB Audit directory and its contents to meet the requirement to protect against unauthorized access.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', and select the 'Security' tab.
 Modify the security permissions to:
 NT AUTHORITY/NetworkService (or configured database service account) (Full Control)
 Administrators (Read)
 Users (none)

Alternatively, the Windows ICACLS command may be used to modify permissions on folders and files using the Windows command prompt.

If other permissions have been granted to other users or groups, ensure the system documentation is updated to note the organizationally approved permission setting and corresponding justification of the permission settings for this requirement."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000163,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109429r1_rule,STIG-ID|EP11-00-002700,SWIFT-CSCv1|2.3,Vuln-ID|V-100325"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data\edb_audit\' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-002800 - The audit information produced by the EDB Postgres Advanced Server must be protected from unauthorized deletion."
  info            : "If audit data were to become compromised, then competent forensic analysis and discovery of the true source of potentially malicious system activity is impossible to achieve.

To ensure the veracity of audit data, the information system and/or the application must protect audit information from unauthorized deletion. This requirement can be achieved through multiple methods which will depend upon system architecture and design.

Some commonly employed methods include: ensuring log files enjoy the proper file system permissions utilizing file system protections; restricting access; and backing up log data to ensure log data is retained.

Applications providing a user interface to audit data will leverage user permissions and roles identifying the user accessing the data and the corresponding rights the user enjoys to make access decisions regarding the deletion of audit data.

Audit information includes all information (e.g., audit records, audit settings, and audit reports) needed to successfully audit information system activity.

Deletion of database audit data could mask the theft of, or the unauthorized modification of, sensitive data stored in the database."
  solution        : "1) Change ownership of EDB Audit directory and its contents to the database service account if they are not owned by the database service account.

If the EDB Audit directory and its contents are not owned by the database service account, change ownership to the service account responsible for running the Advanced Server database service.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', select the 'Securities' tab, and select the 'Advanced' button.
 Select the 'Change' link shown next to the owner of the folder to change the folder's owner.

Alternatively, the Windows TAKEOWN command or the ICACLS command (with the /SETOWNER option) may be used to change ownership of folders and files using the Windows command prompt.

2) Modify permissions on the EDB Audit directory and its contents to meet the requirement to protect against unauthorized access.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', and select the 'Security' tab.
 Modify the security permissions to:
 NT AUTHORITY/NetworkService (or configured database service account) (Full Control)
 Administrators (Read)
 Users (none)

Alternatively, the Windows ICACLS command may be used to modify permissions on folders and files using the Windows command prompt.

If other permissions have been granted to other users or groups, ensure that the system documentation is updated to note the organizationally approved permission setting and corresponding justification of the permission settings for this requirement."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000164,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109431r1_rule,STIG-ID|EP11-00-002800,SWIFT-CSCv1|2.3,Vuln-ID|V-100327"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data\edb_audit\' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-002900 - The EDB Postgres Advanced Server must protect its audit features from unauthorized access."
  info            : "Protecting audit data also includes identifying and protecting the tools used to view and manipulate log data.

Depending upon the log format and application, system and application log tools may provide the only means to manipulate and manage application and system log data. It is, therefore, imperative that access to audit tools be controlled and protected from unauthorized access.

Applications providing tools to interface with audit data will leverage user permissions and roles identifying the user accessing the tools and the corresponding rights the user enjoys to make access decisions regarding the access to audit tools.

Audit tools include, but are not limited to, OS-provided audit tools, vendor-provided audit tools, and open source audit tools needed to successfully view and manipulate audit information system activity and records.

If an attacker were to gain access to audit tools, he could analyze audit logs for system weaknesses or weaknesses in the auditing itself. An attacker could also manipulate logs to hide evidence of malicious activity."
  solution        : "1) Change ownership of EDB Audit directory and its contents to the database service account if they are not owned by the database service account.

If the EDB Audit directory and its contents are not owned by the database service account, change ownership to the service account responsible for running the Advanced Server database service.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', select the 'Securities' tab, and select the 'Advanced' button.
 Select the 'Change' link shown next to the owner of the folder to change the folder's owner.

Alternatively, the Windows TAKEOWN command or the ICACLS command (with the /SETOWNER option) may be used to change ownership of folders and files using the Windows command prompt.

2) Modify permissions on the EDB Audit directory and its contents to meet the requirement to protect against unauthorized access.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', and select the 'Security' tab.
 Modify the security permissions to:
 NT AUTHORITY/NetworkService (or configured database service account) (Full Control)
 Administrators (Read)
 Users (none)

Alternatively, the Windows ICACLS command may be used to modify permissions on folders and files using the Windows command prompt.

If other permissions have been granted to other users or groups, ensure that the system documentation is updated to note the organizationally approved permission setting and corresponding justification of the permission settings for this requirement."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-001493,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109433r1_rule,STIG-ID|EP11-00-002900,SWIFT-CSCv1|2.3,Vuln-ID|V-100329"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data\edb_audit\' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-003000 - The EDB Postgres Advanced Server must protect its audit configuration from unauthorized modification."
  info            : "Protecting audit data also includes identifying and protecting the tools used to view and manipulate log data. Therefore, protecting audit tools is necessary to prevent unauthorized operation on audit data.

Applications providing tools to interface with audit data will leverage user permissions and roles identifying the user accessing the tools and the corresponding rights the user enjoys to make access decisions regarding the modification of audit tools.

Audit tools include, but are not limited to, vendor-provided and open source audit tools needed to successfully view and manipulate audit information system activity and records. Audit tools include custom queries and report generators."
  solution        : "1) Change ownership of EDB Audit directory and its contents to the database service account if they are not owned by the database service account.

If the EDB Audit directory and its contents are not owned by the database service account, change ownership to the service account responsible for running the Advanced Server database service.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', select the 'Securities' tab, and select the 'Advanced' button.
 Select the 'Change' link shown next to the owner of the folder to change the folder's owner.

Alternatively, the Windows TAKEOWN command or the ICACLS command (with the /SETOWNER option) may be used to change ownership of folders and files using the Windows command prompt.

2) Modify permissions on the EDB Audit directory and its contents to meet the requirement to protect against unauthorized access.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', and select the 'Security' tab.
 Modify the security permissions to:
 NT AUTHORITY/NetworkService (or configured database service account) (Full Control)
 Administrators (Read)
 Users (none)

Alternatively, the Windows ICACLS command may be used to modify permissions on folders and files using the Windows command prompt.

If other permissions have been granted to other users or groups, ensure that the system documentation is updated to note the organizationally approved permission setting and corresponding justification of the permission settings for this requirement."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-001494,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109435r1_rule,STIG-ID|EP11-00-003000,SWIFT-CSCv1|2.3,Vuln-ID|V-100331"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data\edb_audit\' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-003100 - The EDB Postgres Advanced Server must protect its audit features from unauthorized removal."
  info            : "Protecting audit data also includes identifying and protecting the tools used to view and manipulate log data. Therefore, protecting audit tools is necessary to prevent unauthorized operation on audit data.

Applications providing tools to interface with audit data will leverage user permissions and roles identifying the user accessing the tools and the corresponding rights the user enjoys to make access decisions regarding the deletion of audit tools.

Audit tools include, but are not limited to, vendor-provided and open source audit tools needed to successfully view and manipulate audit information system activity and records. Audit tools include custom queries and report generators."
  solution        : "1) Change ownership of EDB Audit directory and its contents to the database service account if they are not owned by the database service account.

If the EDB Audit directory and its contents are not owned by the database service account, change ownership to the service account responsible for running the Advanced Server database service.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', select the 'Securities' tab, and select the 'Advanced' button.
 Select the 'Change' link shown next to the owner of the folder to change the folder's owner.

Alternatively, the Windows TAKEOWN command or the ICACLS command (with the /SETOWNER option) may be used to change ownership of folders and files using the Windows command prompt.

2) Modify permissions on the EDB Audit directory and its contents to meet the requirement to protect against unauthorized access.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', and select the 'Security' tab.
 Modify the security permissions to:
 NT AUTHORITY/NetworkService (or configured database service account) (Full Control)
 Administrators (Read)
 Users (none)

Alternatively, the Windows ICACLS command may be used to modify permissions on folders and files using the Windows command prompt.

If other permissions have been granted to other users or groups, ensure that the system documentation is updated to note the organizationally approved permission setting and corresponding justification of the permission settings for this requirement."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-001495,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109437r1_rule,STIG-ID|EP11-00-003100,SWIFT-CSCv1|2.3,Vuln-ID|V-100333"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data\edb_audit\' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<report type:"WARNING">
  description : "EP11-00-003200 - Software, applications, and configuration files that are part of, or related to, the Postgres Plus Advanced Server installation must be monitored to discover unauthorized changes."
  info        : "If the system were to allow any user to make changes to software libraries, then those changes might be implemented without undergoing the appropriate testing and approvals that are part of a robust change management process.

Accordingly, only qualified and authorized individuals will be allowed to obtain access to information system components for purposes of initiating changes, including upgrades and modifications. Monitoring is required for assurance that the protections are effective.

Unmanaged changes that occur to the database software libraries or configuration can lead to unauthorized or compromised installations.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Implement procedures to monitor for unauthorized changes to DBMS software libraries, related software application libraries, and configuration files. If a third-party automated tool is not employed, an automated job that reports file information on the directories and files of interest and compares them to the baseline report for the same will meet the requirement.

Use file hashes or checksums for comparisons, as file dates may be manipulated by malicious users."
  reference   : "CAT|II,CCI|CCI-001499,Rule-ID|SV-109439r1_rule,STIG-ID|EP11-00-003200,Vuln-ID|V-100335"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<report type:"WARNING">
  description : "EP11-00-003400 - Database software, including EDB Postgres Advanced Server configuration files, must be stored in dedicated directories, separate from the host OS and other applications."
  info        : "When dealing with change control issues, it should be noted any changes to the hardware, software, and/or firmware components of the information system and/or application can potentially have significant effects on the overall security of the system.

Multiple applications can provide a cumulative negative effect. A vulnerability and subsequent exploit to one application can lead to an exploit of other applications sharing the same security context. For example, an exploit to a web server process that leads to unauthorized administrative access to host system directories can most likely lead to a compromise of all applications hosted by the same system. Database software not installed using dedicated directories both threatens and is threatened by other hosted applications. Access controls defined for one application may by default provide access to the other application's database objects or directories. Any method that provides any level of separation of security context assists in the protection between applications.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Install all applications on directories separate from the DBMS software library directory. Relocate any directories or reinstall other application software that currently shares the DBMS software library directory."
  reference   : "CAT|II,CCI|CCI-001499,Rule-ID|SV-109445r1_rule,STIG-ID|EP11-00-003400,Vuln-ID|V-100341"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<report type:"WARNING">
  description : "EP11-00-003600 - The role(s)/group(s) used to modify database structure (including but not necessarily limited to tables, indexes, storage, etc.) and logic modules (stored procedures, functions, triggers, links to software external to the EDB Postgres Advanced Server, etc.) must be restricted to authorized users."
  info        : "If the DBMS were to allow any user to make changes to database structure or logic, then those changes might be implemented without undergoing the appropriate testing and approvals that are part of a robust change management process.

Accordingly, only qualified and authorized individuals must be allowed to obtain access to information system components for purposes of initiating changes, including upgrades and modifications.

Unmanaged changes that occur to the database software libraries or configuration can lead to unauthorized or compromised installations.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Revoke unauthorized privileges.

The syntax is:
 REVOKE <privilege> ON <object> FROM <role>.

Example:
 REVOKE INSERT ON a FROM PUBLIC;

See PostgreSQL documentation for details."
  reference   : "CAT|II,CCI|CCI-001499,Rule-ID|SV-109449r1_rule,STIG-ID|EP11-00-003600,Vuln-ID|V-100345"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-003900 - Unused database components which are integrated in the EDB Postgres Advanced Server and cannot be uninstalled must be disabled."
  info            : "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).

It is detrimental for software products to provide, or install by default, functionality exceeding requirements or mission objectives.

DBMSs must adhere to the principles of least functionality by providing only essential capabilities.

Unused, unnecessary DBMS components increase the attack vector for the DBMS by introducing additional targets for attack. By minimizing the services and applications installed on the system, the number of potential vulnerabilities is reduced. Components of the system that are unused and cannot be uninstalled must be disabled. The techniques available for disabling components will vary by DBMS product, OS, and the nature of the component, and may include DBMS configuration settings, OS service settings, OS file access security, and DBMS user/role permissions.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "Open Control Program >> Programs >> Programs and Features. Select any programs that should not be installed, click 'uninstall', and then follow the prompts to uninstall the software."
  reference       : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CCI|CCI-000381,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS15a,Rule-ID|SV-109455r1_rule,STIG-ID|EP11-00-003900,SWIFT-CSCv1|2.3,Vuln-ID|V-100351"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "ManualReviewRequired"
  powershell_args : "Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-List"
  check_type      : CHECK_REGEX
  severity        : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-004000 - Access to external executables must be disabled or restricted."
  info            : "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).

It is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.

Applications must adhere to the principles of least functionality by providing only essential capabilities.

EDB Postgres Advanced Server may spawn additional external processes to execute procedures that are defined in EDB Postgres Advanced Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than EDB Postgres Advanced Server and provide unauthorized access to the host system.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "To uninstall programs that are not approved, open Control Program | Programs | Programs and Features. Select any programs that should not be installed, click the 'uninstall' button, and follow the prompts to uninstall the software.

To remove the SUPERUSER privilege from a role, execute the following SQL statement in psql or another Postgres SQL client as enterprisedb:

 ALTER ROLE <role name> WITH NOSUPERUSER;

To remove a role that has been granted to another role, execute the following SQL statement in psql or another Postgres SQL client as enterprisedb:

 REVOKE ROLE <name of role to be removed> FROM <role name>;

To remove an extension from a Postgres database, execute the following SQL statement in psql or another Postgres SQL client as enterprisedb:

 DROP EXTENSION <name of extension to be removed>;

To remove a function from a Postgres database, execute the following SQL statement in psql or another Postgres SQL client as enterprisedb:

 DROP FUNCTION <name of function to be removed>;

If the unapproved function is contained in an EDB-SPL database package, drop the package specification and body or replace the package specification and package body source with an updated version of the source that does not include the unapproved function.

To drop a package, execute the following SQL statements in psql or another EDB Postgres Advanced Server SQL client as enterprisedb:

 DROP PACKAGE BODY <name of package to be dropped>;
 DROP PACKAGE <name of package to be dropped>;

To update a package, execute the 'CREATE OR REPLACE PACKAGE <package name>' and 'CREATE OR REPLACE PACKAGE BODY <package name>' SQL statements in psql or another EDB Postgres Advanced Server SQL client. See the EnterpriseDB 'Database Compatibility for Oracle Developers Reference Guide' for more information about the commands for creating, replacing, and dropping database packages."
  reference       : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CCI|CCI-000381,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS15a,Rule-ID|SV-109457r1_rule,STIG-ID|EP11-00-004000,SWIFT-CSCv1|2.3,Vuln-ID|V-100353"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "ManualReviewRequired"
  powershell_args : "Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-List"
  check_type      : CHECK_REGEX
  severity        : MEDIUM
</custom_item>

<custom_item>
  type        : FILE_CONTENT_CHECK_NOT
  description : "EP11-00-004200 - The EDB Postgres Advanced Server must uniquely identify and authenticate organizational users (or processes acting on behalf of organizational users)."
  info        : "To assure accountability and prevent unauthenticated access, organizational users must be identified and authenticated to prevent potential misuse and compromise of the system.

Organizational users include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors). Organizational users (and any processes acting on behalf of users) must be uniquely identified and authenticated for all accesses, except the following:

(i) Accesses explicitly identified and documented by the organization. Organizations document specific user actions that can be performed on the information system without identification or authentication; and
(ii) Accesses that occur through authorized use of group authenticators without individual authentication. Organizations may require unique identification of individuals in group accounts (e.g., shared privilege accounts) or for detailed accountability of individual activity."
  solution    : "Open '<postgresql data directory>\pg_hba.conf' in an editor.

Note that the default location for the pg_hba.conf file is in the postgresql data directory. The location of the pg_hba.conf file for a running postgres instance can be found using the following command run from a Windows command prompt:

 psql -d <database name> -U <database superuser name> -c 'SHOW hba_file'

where, <database name> is any database in the EDB postgres instance and <database superuser name> is a database superuser. By default, a database named 'edb' and a superuser named 'enterprisedb' are installed with EDB Postgres Advanced Server (EPAS).

If any rows have 'trust' specified for the 'METHOD' column that are not documented and approved, delete the rows or change them to other authentication methods.

Permitted methods in preferred order are: peer (local only), cert, ldap, sspi, pam, sha-256-scram, md5"
  reference   : "800-171|3.1.1,800-53|AC-3,CAT|II,CCI|CCI-000764,CN-L3|8.1.10.2(c),CN-L3|8.1.4.11(b),CN-L3|8.1.4.2(f),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,Rule-ID|SV-109461r1_rule,STIG-ID|EP11-00-004200,TBA-FIISB|31.1,Vuln-ID|V-100357"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*[^#]*[\s]*trust([\s]|$)"
  expect      : "^[\s]*[^#]*[\s]*trust([\s]|$)"
</custom_item>

<custom_item>
  type        : FILE_CONTENT_CHECK_NOT
  description : "EP11-00-004400 - If passwords are used for authentication, the EDB Postgres Advanced Server must transmit only encrypted representations of passwords."
  info        : "The DoD standard for authentication is DoD-approved PKI certificates.

Authentication based on User ID and Password may be used only when it is not possible to employ a PKI certificate, and requires AO approval.

In such cases, passwords need to be protected at all times, and encryption is the standard method for protecting passwords during transmission.

DBMS passwords sent in clear text format across the network are vulnerable to discovery by unauthorized users. Disclosure of passwords may easily lead to unauthorized access to the database."
  solution    : "Open '<postgresql data directory>\pg_hba.conf' in an editor.

Note that the default location for the pg_hba.conf file is in the postgresql data directory. The location of the pg_hba.conf file for a running postgres instance can be found using the following command run from a Windows command prompt:

 psql -d <database name> -U <database superuser name> -c 'SHOW hba_file'

where, <database name> is any database in the EDB postgres instance and <database superuser name> is a database superuser. By default, a database named 'edb' and a superuser named 'enterprisedb' are installed with EDB Postgres Advanced Server (EPAS).

For any rows that have 'password' specified for the 'METHOD' column, change the value to 'sha-256-scram' or 'md5'."
  reference   : "800-171|3.4.1,800-53|CM-8,CAT|II,CCI|CCI-000197,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,Rule-ID|SV-109467r1_rule,STIG-ID|EP11-00-004400,Vuln-ID|V-100363"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*[^#]*[\s]*password([\s]|$)"
  expect      : "^[\s]*[^#]*[\s]*password([\s]|$)"
</custom_item>

<custom_item>
  type        : FILE_CONTENT_CHECK
  description : "EP11-00-004500 - The EDB Postgres Advanced Server, when utilizing PKI-based authentication, must validate certificates by performing RFC 5280-compliant certification path validation."
  info        : "The DoD standard for authentication is DoD-approved PKI certificates.

A certificate's certification path is the path from the end entity certificate to a trusted root certification authority (CA). Certification path validation is necessary for a relying party to make an informed decision regarding acceptance of an end entity certificate. Certification path validation includes checks such as certificate issuer trust, time validity, and revocation status for each certificate in the certification path. Revocation status information for CA and subject certificates in a certification path is commonly provided via certificate revocation lists (CRLs) or online certificate status protocol (OCSP) responses.

Database Management Systems that do not validate certificates by performing RFC 5280-compliant certification path validation are in danger of accepting certificates that are invalid and/or counterfeit. This could allow unauthorized access to the database.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Open the '<postgresql data directory>\pg_hba.conf' in an editor.

Note that the default location for the pg_hba.conf file is in the postgresql data directory. The location of the pg_hba.conf file for a running postgres instance can be found using the following command run from a Windows command prompt:

 psql -d <database name> -U <database superuser name> -c 'SHOW hba_file'

where, <database name> is any database in the EDB postgres instance and <database superuser name> is a database superuser. By default, a database named 'edb' and a superuser named 'enterprisedb' are installed with EDB Postgres Advanced Server (EPAS).

For any rows that have TYPE of 'hostssl', append 'clientcert=1' in the OPTIONS column at the end of the line."
  reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CCI|CCI-000185,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-109469r1_rule,STIG-ID|EP11-00-004500,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-100365"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*hostssl[\s]"
  expect      : "^[\s]*hostssl[\s].*[\s]clientcert=1([\s]|$)"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-004600 - The EDB Postgres Advanced Server must enforce authorized access to all PKI private keys stored/utilized by the EDB Postgres Advanced Server."
  info            : "The DoD standard for authentication is DoD-approved PKI certificates. PKI certificate-based authentication is performed by requiring the certificate holder to cryptographically prove possession of the corresponding private key.

If the private key is stolen, an attacker can use the private key(s) to impersonate the certificate holder. In cases where the DBMS-stored private keys are used to authenticate the DBMS to the system's clients, loss of the corresponding private keys would allow an attacker to successfully perform undetected man in the middle attacks against the DBMS system and its clients.

Both the holder of a digital certificate and the issuing authority must take careful measures to protect the corresponding private key. Private keys should always be generated and protected in FIPS 140-2 validated cryptographic modules.

All access to the private key(s) of the DBMS must be restricted to authorized and authenticated users. If unauthorized users have access to one or more of the DBMS's private keys, an attacker could gain access to the key(s) and use them to impersonate the database on the network or otherwise perform unauthorized actions."
  solution        : "Right-click and select 'Properties' on <postgresql data directory>\server.key

Give the database administrator (default 'enterprisedb') full control of the file."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|I,CCI|CCI-000186,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109471r1_rule,STIG-ID|EP11-00-004600,SWIFT-CSCv1|2.3,Vuln-ID|V-100367"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data\server.key' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<custom_item>
  type        : FILE_CHECK
  description : "EP11-00-004850 - The EDB Postgres Advanced Server password file must not be used."
  info        : "The EDB Postgres password file can contain passwords to be used if the connection allows a password (and no password has been specified otherwise).

This file contain lines of the following format:
hostname:port:database:username:password

It is critically important to system security that use of a password file be avoided as it stores passwords in plain text. Any user with access to these could potentially compromise the security of the database."
  solution    : "Remove any password files present on the server and implement a  more secure form of authentication.

The DoD standard for authentication is DoD-approved PKI certificates."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CCI|CCI-000366,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,Rule-ID|SV-110213r1_rule,STIG-ID|EP11-00-004850,SWIFT-CSCv1|2.3,Vuln-ID|V-101109"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @APP_DATA@ replaced with "C:\\Users\\Administrator\\AppData" in field "value_data".
  value_data  : "C:\\Users\\Administrator\\AppData\postgresql\pgpass.conf"
  file_option : MUST_NOT_EXIST
</custom_item>

<custom_item>
  type        : FILE_CONTENT_CHECK
  description : "EP11-00-004900 - The EDB Postgres Advanced Server must use NIST FIPS 140-2 validated cryptographic modules for all cryptographic operations including  generation of cryptographic hashes and data protection. - hostssl"
  info        : "Use of weak or not validated cryptographic algorithms undermines the purposes of utilizing encryption and digital signatures to protect data. Weak algorithms can be easily broken and not validated cryptographic modules may not implement algorithms correctly. Unapproved cryptographic modules or algorithms should not be relied on for authentication, confidentiality, or integrity. Weak cryptography could allow an attacker to gain access to and modify data stored in the database as well as the administration settings of the DBMS.

Applications, including DBMSs, utilizing cryptography are required to use approved NIST FIPS 140-2 validated cryptographic modules that meet the requirements of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

The security functions validated as part of FIPS 140-2 for cryptographic modules are described in FIPS 140-2 Annex A.

NSA Type-X (where X=1, 2, 3, 4) products are NSA-certified, hardware-based encryption modules.

Postgres uses OpenSSL for the underlying encryption layer. Organizations must obtain and use a FIPS 140-2 certified distribution of OpenSSL or build their own FIPS 140-2 OpenSSL libraries. EnterpriseDB has a FIPS 140-2 validated set of cryptographic modules for use with OpenSSL on Windows to meet this requirement for EDB Postgres Advanced Server deployments.

It is the responsibility of the data owner to assess the cryptography requirements in light of applicable federal laws, Executive Orders, directives, policies, regulations, and standards.

For detailed information, refer to NIST FIPS Publication 140-2, Security Requirements For Cryptographic Modules. Note that the product's cryptographic modules must be validated and certified by NIST as FIPS-compliant.

When the EDB FIPS 140-2 certified cryptographic modules are configured properly, an EDB Postgres Advanced Server will fail to start if non-FIPS 140-2 ciphers are specified for the Postgres ssl_ciphers parameter. To test whether the FIPS 140-2 compliant configuration is working, temporarily set the 'ssl_ciphers' parameter in the postgresql.conf file to 'RC4-SHA' and then attempt to restart the database service. Since 'RC4-SHA' is not a FIPS 140-2 approved cipher, the database will fail to start. Using the Event Viewer in Windows, a 'FATAL: could not set the cipher list (no valid ciphers available)' error will be found under 'Event Viewer (Local) >> Windows Logs >> Application'.

Satisfies: SRG-APP-000179-DB-000114,SRG-APP-000514-DB-000382,SRG-APP-000514-DB-000383

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Edit <postgresql data dir>\pg_hba.conf so that each uncommented line starts with 'hostssl'

If the EDB Postgres Advanced Server minor version is less than version 11.6, install the 11.6 update or later version or contact EnterpriseDB to obtain a copy of the FIPS 140-2 compliant versions of the 'ssleay32.dll' and 'libeay32.dll' files and replace the 'ssleay32.dll' and 'libeay32.dll' files in <EDB Postgres Advanced Server Home>\bin with FIPS 140-2 compliant DLLs from EnterpriseDB. If the EDB Postgres Advanced Server minor version is 11.6 or greater, the FIPS 140-2 compliant versions of these DLLs are installed by default and do not need to be replaced.

Create C:\usr\local\ssl\openssl.cnf or another file referenced by a System Environment variable called OPENSSL_CONF with these contents:

HOME = .
RANDFILE = $ENV::HOME/.rnd
openssl_conf=openssl_conf_section
[openssl_conf_section]
alg_section=evp_settings
[evp_settings]
fips_mode=yes

Restart the Postgres server via the Services administration GUI."
  reference   : "800-171|3.4.1,800-53|CM-8,CAT|I,CCI|CCI-000803,CCI|CCI-002450,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,Rule-ID|SV-109477r1_rule,STIG-ID|EP11-00-004900,Vuln-ID|V-100373"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*hostssl[\s]"
  expect      : "^[\s]*hostssl[\s].*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-004900 - The EDB Postgres Advanced Server must use NIST FIPS 140-2 validated cryptographic modules for all cryptographic operations including  generation of cryptographic hashes and data protection. - openssl_conf"
  info            : "Use of weak or not validated cryptographic algorithms undermines the purposes of utilizing encryption and digital signatures to protect data. Weak algorithms can be easily broken and not validated cryptographic modules may not implement algorithms correctly. Unapproved cryptographic modules or algorithms should not be relied on for authentication, confidentiality, or integrity. Weak cryptography could allow an attacker to gain access to and modify data stored in the database as well as the administration settings of the DBMS.

Applications, including DBMSs, utilizing cryptography are required to use approved NIST FIPS 140-2 validated cryptographic modules that meet the requirements of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

The security functions validated as part of FIPS 140-2 for cryptographic modules are described in FIPS 140-2 Annex A.

NSA Type-X (where X=1, 2, 3, 4) products are NSA-certified, hardware-based encryption modules.

Postgres uses OpenSSL for the underlying encryption layer. Organizations must obtain and use a FIPS 140-2 certified distribution of OpenSSL or build their own FIPS 140-2 OpenSSL libraries. EnterpriseDB has a FIPS 140-2 validated set of cryptographic modules for use with OpenSSL on Windows to meet this requirement for EDB Postgres Advanced Server deployments.

It is the responsibility of the data owner to assess the cryptography requirements in light of applicable federal laws, Executive Orders, directives, policies, regulations, and standards.

For detailed information, refer to NIST FIPS Publication 140-2, Security Requirements For Cryptographic Modules. Note that the product's cryptographic modules must be validated and certified by NIST as FIPS-compliant.

When the EDB FIPS 140-2 certified cryptographic modules are configured properly, an EDB Postgres Advanced Server will fail to start if non-FIPS 140-2 ciphers are specified for the Postgres ssl_ciphers parameter. To test whether the FIPS 140-2 compliant configuration is working, temporarily set the 'ssl_ciphers' parameter in the postgresql.conf file to 'RC4-SHA' and then attempt to restart the database service. Since 'RC4-SHA' is not a FIPS 140-2 approved cipher, the database will fail to start. Using the Event Viewer in Windows, a 'FATAL: could not set the cipher list (no valid ciphers available)' error will be found under 'Event Viewer (Local) >> Windows Logs >> Application'.

Satisfies: SRG-APP-000179-DB-000114,SRG-APP-000514-DB-000382,SRG-APP-000514-DB-000383"
  solution        : "Edit <postgresql data dir>\pg_hba.conf so that each uncommented line starts with 'hostssl'

If the EDB Postgres Advanced Server minor version is less than version 11.6, install the 11.6 update or later version or contact EnterpriseDB to obtain a copy of the FIPS 140-2 compliant versions of the 'ssleay32.dll' and 'libeay32.dll' files and replace the 'ssleay32.dll' and 'libeay32.dll' files in <EDB Postgres Advanced Server Home>\bin with FIPS 140-2 compliant DLLs from EnterpriseDB. If the EDB Postgres Advanced Server minor version is 11.6 or greater, the FIPS 140-2 compliant versions of these DLLs are installed by default and do not need to be replaced.

Create C:\usr\local\ssl\openssl.cnf or another file referenced by a System Environment variable called OPENSSL_CONF with these contents:

HOME = .
RANDFILE = $ENV::HOME/.rnd
openssl_conf=openssl_conf_section
[openssl_conf_section]
alg_section=evp_settings
[evp_settings]
fips_mode=yes

Restart the Postgres server via the Services administration GUI."
  reference       : "800-171|3.4.1,800-53|CM-8,CAT|I,CCI|CCI-000803,CCI|CCI-002450,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ISO/IEC-27001|A.8.1.1,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,Rule-ID|SV-109477r1_rule,STIG-ID|EP11-00-004900,Vuln-ID|V-100373"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : 'openssl_conf=openssl_conf_section'
  powershell_args : 'Get-Content \'C:\\usr\\local\\ssl\\openssl.cnf\' | where { $_.Contains(\\"openssl_conf\\") }'
  check_type      : CHECK_REGEX
</custom_item>

<report type:"WARNING">
  description : "EP11-00-005700 - The EDB Postgres Advanced Server must protect the confidentiality and integrity of all information at rest."
  info        : "This control is intended to address the confidentiality and integrity of information at rest in non-mobile devices and covers user information and system information. Information at rest refers to the state of information when it is located on a secondary storage device (e.g., disk drive, tape drive) within an organizational information system. Applications and application users generate information throughout the course of their application use.

User data generated, as well as application-specific configuration data, must be protected. Organizations may choose to employ different mechanisms to achieve confidentiality and integrity protections, as appropriate.

If the confidentiality and integrity of application data is not protected, the data will be open to compromise and unauthorized modification.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Complete these steps as the Windows user that serves as the user who is configure to run the EDB Postgres database service. If done as a different user, the Windows database service user will be unable to view this folder and therefore unable to start the database. By default, the service is configured to be run by the NetworkService account, which is a special Windows account that may not have the ability to encrypt the data directory. As a result, it may be necessary to change the service to run under a different account that can access the directory and encrypt it.

Use the following steps, to update the service, encrypt the data directory, and restart the service:
1. Change the edb-as-11 service to run as a local user account that is the same domain user that will be used to encrypt the data directory (ex. 'administrator').
Open Computer Management >> Services.
Highlight the 'edb-as-11 service'.
Stop the service.
Select the service properties.
Select the 'Log On' tab, and update the 'Log on as' setting to an account such as 'Administrator'.

2. Encrypt the data directory by following these instructions (logged in as the user who runs the service):
Right-click on <postgresql data directory>, select properties, select the Advanced button in the General tab, and then select the 'Encrypt contents to secure data' checkbox in the 'Advanced Attributes' window. Select the option to apply to subfolders and files when prompted.

3. Restart the EDB service after encrypting the drive."
  reference   : "CAT|II,CCI|CCI-001199,Rule-ID|SV-109483r1_rule,STIG-ID|EP11-00-005700,Vuln-ID|V-100379"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-006100 - Access to database files must be limited to relevant processes and to authorized, administrative users."
  info            : "Applications, including DBMSs, must prevent unauthorized and unintended information transfer via shared system resources. Permitting only DBMS processes and authorized, administrative users to have access to the files where the database resides helps ensure that those files are not shared inappropriately and are not open to backdoor access and manipulation."
  solution        : "If the postgresql data directory and its contents are not owned by the database service account or other user as documented and approved in the system documentation, change ownership to an authorized user.

Modify permissions on the data directory and its contents to meet the requirement to protect against unauthorized access.

This may be done using Windows Explorer:
 Browse to the directory where the EDB audit directory folder is located.
 Select and right-click on the folder, select 'Properties', and select the 'Security' tab.
 Modify the security permissions to:
 NT AUTHORITY/NetworkService (or configured database service account) (Full Control)
 Administrators (Full Control)
 Users (none)

Alternatively, the Windows ICACLS command may be used to modify permissions on folders and files using the Windows command prompt.

If other permissions have been granted to other users or groups, ensure that the system documentation is updated to note the organizationally approved permission setting and corresponding justification of the permission settings for this requirement."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-001090,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-109489r1_rule,STIG-ID|EP11-00-006100,SWIFT-CSCv1|2.3,Vuln-ID|V-100385"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
# Note: Variable @PG_USER@ replaced with "enterprisedb" in field "value_data".
  value_data      : "enterprisedb"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "Get-Acl 'C:\\Program Files\\edb\\as11\\data' | Select-Object Owner | Format-List"
  check_type      : CHECK_REGEX
</custom_item>

<report type:"WARNING">
  description : "EP11-00-008000 - The EDB Postgres Advanced Server must provide a warning to appropriate support staff when allocated audit record storage volume reaches 75% of maximum audit record storage capacity."
  info        : "Organizations are required to use a central log management system, so, under normal conditions, the audit space allocated to EDB Postgres on its own server will not be an issue. However, space will still be required on the EDB Postgres server for audit records in transit, and, under abnormal conditions, this could fill up. Since a requirement exists to halt processing upon audit failure, a service outage would result.

If support personnel are not notified immediately upon storage volume utilization reaching 75%, they are unable to plan for storage capacity expansion.

The appropriate support staff include, at a minimum, the ISSO and the DBA/SA.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Install PEM (or similar tool) and configure a probe to monitor '<postgresql data directory>' and notify appropriate support staff upon storage volume utilization reaching 75 percent.

(The default path for the postgresql data directory is C:\Program Files\edb\as<version>\data, but this will vary according to local circumstances.)

Example steps for creating a probe are below, using the thin client (browser) PEM interface. Refer also to the Supplemental Procedures document, supplied with this STIG.

Open the PEM web console in a browser.
- Log in.
- Click on the agent for the machine to be monitored.
- Select 'Management | Probe Configuration'.
- Select 'Disk Space' and set the check interval as you like.
- Select 'Management | Alerting'.
- Name the definition 'Audit Log Full'.
- Select Template 'Disk Consumption Percentage'.
- Set Frequency, Comparison Operator, and Thresholds (1 minute, >, 74/75/76 for example).
- Enter the Location for the audit log.
- Click Notification tab.
- Click Email all alerts.
- Click Add/Change to save, click 'OK' to exit dialog box."
  reference   : "CAT|II,CCI|CCI-001855,Rule-ID|SV-109521r1_rule,STIG-ID|EP11-00-008000,Vuln-ID|V-100417"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<report type:"WARNING">
  description : "EP11-00-008400 - The EDB Postgres Advanced Server must prohibit user installation of logic modules (stored procedures, functions, triggers, views, etc.) without explicit privileged status."
  info        : "Allowing regular users to install software, without explicit privileges, creates the risk that untested or potentially malicious software will be installed on the system. Explicit privileges (escalated or administrative privileges) provide the regular user with explicit capabilities and control that exceed the rights of a regular user.

DBMS functionality and the nature and requirements of databases will vary; so while users are not permitted to install unapproved software, there may be instances where the organization allows the user to install approved software packages such as from an approved software repository. The requirements for production servers will be more restrictive than those used for development and research.

The DBMS must enforce software installation by users based upon what types of software installations are permitted (e.g., updates and security patches to existing software) and what types of installations are prohibited (e.g., software whose pedigree with regard to being potentially malicious is unknown or suspect) by the organization.

In the case of a database management system, this requirement covers stored procedures, functions, triggers, views, etc.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Document and obtain approval for any non-administrative users who require the ability to create, alter, or replace logic modules.

Implement the approved permissions. Revoke (or deny) any unapproved permissions and remove any unauthorized role memberships.

Use the REVOKE SQL command to remove privileges from databases and schemas.

 For example, to revoke create privileges on a database:
 REVOKE CREATE ON DATABASE <database_name > FROM <role_name>;

 To revoke create privileges on a database:
 REVOKE CREATE ON SCHEMA <schema_name> FROM <role_name>;"
  reference   : "CAT|II,CCI|CCI-001812,Rule-ID|SV-109525r1_rule,STIG-ID|EP11-00-008400,Vuln-ID|V-100421"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<report type:"WARNING">
  description : "EP11-00-008500 - The EDB Postgres Advanced Server must enforce access restrictions associated with changes to the configuration of the EDB Postgres Advanced Server or database(s)."
  info        : "Failure to provide logical access restrictions associated with changes to configuration may have significant effects on the overall security of the system.

When dealing with access restrictions pertaining to change control, it should be noted that any changes to the hardware, software, and/or firmware components of the information system can potentially have significant effects on the overall security of the system.

Accordingly, only qualified and authorized individuals must be allowed to obtain access to system components for the purposes of initiating changes, including upgrades and modifications.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure EDB Postgres Advanced Server to enforce access restrictions associated with changes to the configuration of the EDB Postgres database(s).

Remove superuser rights from unauthorized database users via the ALTER ROLE or ALTER USER SQL command.

 The syntax is:
 ALTER ROLE <role> NOSUPERUSER
 or
 ALTER USER <user> NOSUPERUSER

 Example:
 ALTER ROLE testuser NOSUPERUSER;
 OR
 ALTER USER testuser NOSUPERUSER;

Use the REVOKE SQL command to remove privileges from databases and schemas.

 For example:
 REVOKE ALL PRIVILEGES ON <table> FROM <role_name>;"
  reference   : "CAT|II,CCI|CCI-001813,Rule-ID|SV-109527r1_rule,STIG-ID|EP11-00-008500,Vuln-ID|V-100423"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<custom_item>
  type        : FILE_CONTENT_CHECK_NOT
  description : "EP11-00-008700 - The EDB Postgres Advanced Server must disable network functions, ports, protocols, and services deemed by the organization to be nonsecure, in accord with the Ports, Protocols, and Services Management (PPSM) guidance."
  info        : "Use of nonsecure network functions, ports, protocols, and services exposes the system to avoidable threats.

A database cluster listens on a single port (usually 5444 for Postgres Plus Advanced Server). The Postgres Enterprise Manager (PEM) agents do not listen on ports, they only act as clients to the PEM server. The PEM server has two components (a repository which is a Postgres database) and an Apache HTTPD application. The Apache HTTPD application listens on a port configured in Apache, generally 8080 or 8443.

The ports to check are:
1) The primary Postgres cluster port,
2) If PEM is in use, the PEM Apache HTTPD port, and
3) The PEM Repository DB port.

Generally 2 and 3 should be installed on an isolated management machine without access from anyone other than administrators."
  solution    : "Disable each prohibited network function, port, protocol, or service prohibited by the PPSM guidance.

Open the pg_hba.conf file in an editor and change the TYPE of any rows not starting with a '#' to be 'hostssl'. The METHOD for the hostssl rows should be one of these (in preferred order): cert, sspi, ldap, scram-sha-256

Note that the default location for the pg_hba.conf file is in the postgresql data directory. The location of the pg_hba.conf file for a running postgres instance can be found using the following command run from a Windows command prompt:

 psql -d <database name> -U <database superuser name> -c 'SHOW hba_file'

where, <database name> is any database in the EDB postgres instance and <database superuser name> is a database superuser. By default, a database named 'edb' and a superuser named 'enterprisedb' are installed with EDB Postgres Advanced Server (EPAS).

Execute the following SQL as enterprisedb:

 ALTER SYSTEM SET port = <port>;

Restart the database service. For EDB Postgres Advanced Server, the default service name for an instance will be 'edb-as-<version>' with a default display name of 'edb-as-<version> - Advanced Server <version>', where '<version>' is the major version number of the EDB Postgres Advanced Server that is installed:

To restart the database service, using the Windows Services Control Manager:
 1. Open the Windows Services Control Manager.
 2. Select the database service from the list of services, right-click it, and select 'Restart'.

Alternatively, the database can be restarted via the Windows command line using either the NET or SC command as follows:

 NET STOP <service name>
 NET START <service name>

or

 SC STOP <service name>
 SC START <service name>

In the above commands, replace <service name> with the actual service name corresponding to the EDB Postgres instance.

Note that if pgAgent is installed and running, the corresponding pgAgent service is dependent on the EDB Postgres database service and must first be stopped to restart the database service. After restarting the database service, the pgAgent service may be started again."
  reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CCI|CCI-001762,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-109531r1_rule,STIG-ID|EP11-00-008700,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-100427"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*(host|hostnossl)[\s]"
  expect      : "^[\s]*(host|hostnossl)[\s]"
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-009100 - The EDB Postgres Advanced Server must only accept end entity certificates issued by DoD PKI or DoD-approved PKI Certification Authorities (CAs) for the establishment of all encrypted sessions."
  info            : "Only DoD-approved external PKIs evaluated to ensure security controls and identity vetting procedures are in place that are sufficient for DoD systems to rely on the identity asserted in the certificate. PKIs lacking sufficient security controls and identity vetting procedures risk being compromised and issuing certificates that enable adversaries to impersonate legitimate users.

The authoritative list of DoD-approved PKIs is published at https://cyber.mil/pki-pke/interoperability/.

This requirement focuses on communications protection for the DBMS session rather than for the network packet.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "Contact your program security office to request DoD issued certificates:

root.crt (CA Certificate)
server.crt
server.key"
  reference       : "800-171|3.13.11,800-53|SC-13,CAT|II,CCI|CCI-002470,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-109535r1_rule,STIG-ID|EP11-00-009100,Vuln-ID|V-100431"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "ManualReviewRequired"
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "powershell_args".
  powershell_args : "CertUtil C:\\Program Files\\edb\\as11\\data\server.crt"
  check_type      : CHECK_REGEX
  severity        : MEDIUM
</custom_item>

<report type:"WARNING">
  description : "EP11-00-009200 - The EDB Postgres Advanced Server must implement cryptographic mechanisms to prevent unauthorized modification of organization-defined information at rest (to include, at a minimum, PII and classified information) on organization-defined information system components."
  info        : "DBMSs handling data requiring 'data at rest' protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest. These cryptographic mechanisms may be native to the DBMS or implemented via additional software or operating system/file system settings, as appropriate to the situation.

Selection of a cryptographic mechanism is based on the need to protect the integrity of organizational information. The strength of the mechanism is commensurate with the security category and/or classification of the information. Organizations have the flexibility to either encrypt all information on storage devices (i.e., full disk encryption) or encrypt specific data structures (e.g., files, records, or fields).

The decision whether and what to encrypt rests with the data owner and is also influenced by the physical measures taken to secure the equipment and media on which the information resides.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Do these steps as the Windows user that is the database administrators (default is enterprisedb), if done as a different user, the Windows database administration user will be unable to view this folder and therefore unable to start the database:

Right-click on <postgresql data directory>, select properties, then select the General tab and the Advanced button. Select option to apply to subfolders and files when prompted."
  reference   : "CAT|II,CCI|CCI-002475,Rule-ID|SV-109537r1_rule,STIG-ID|EP11-00-009200,Vuln-ID|V-100433"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<report type:"WARNING">
  description : "EP11-00-009300 - The EDB Postgres Advanced Server must implement cryptographic mechanisms preventing the unauthorized disclosure of organization-defined information at rest on organization-defined information system components."
  info        : "DBMSs handling data requiring 'data at rest' protections must employ cryptographic mechanisms to prevent unauthorized disclosure and modification of the information at rest. These cryptographic mechanisms may be native to the DBMS or implemented via additional software or operating system/file system settings, as appropriate to the situation.

Selection of a cryptographic mechanism is based on the need to protect the integrity of organizational information. The strength of the mechanism is commensurate with the security category and/or classification of the information. Organizations have the flexibility to either encrypt all information on storage devices (i.e., full disk encryption) or encrypt specific data structures (e.g., files, records, or fields).

The decision whether and what to encrypt rests with the data owner and is influenced by the physical measures taken to secure the equipment and media on which the information resides.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Do these steps as the Windows user that is the database administrators (default is enterprisedb). If done as a different user, the Windows database administration user will be unable to view this folder and therefore unable to start the database:

Right-click on <postgresql data directory>, select properties, then select the General tab and the Advanced button. Select option to apply to subfolders and files when prompted."
  reference   : "CAT|II,CCI|CCI-002476,Rule-ID|SV-109539r1_rule,STIG-ID|EP11-00-009300,Vuln-ID|V-100435"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
</report>

<custom_item>
  type        : FILE_CONTENT_CHECK
  description : "EP11-00-009500 - The EDB Postgres Advanced Server must maintain the confidentiality and integrity of information during preparation for transmission."
  info        : "Information can be either unintentionally or maliciously disclosed or modified during preparation for transmission, including, for example, during aggregation, at protocol transformation points, and during packing/unpacking. These unauthorized disclosures or modifications compromise the confidentiality or integrity of the information.

Use of this requirement will be limited to situations where the data owner has a strict requirement for ensuring data integrity and confidentiality is maintained at every step of the data transfer and handling process.

When transmitting data, the DBMS, associated applications, and infrastructure must leverage transmission protection mechanisms."
  solution    : "Open '<postgresql data directory>\pg_hba.conf' in an editor. (The default path of the postgresql data directory for an EDB Postgres Advanced Server (EPAS) installation on Microsoft Windows is C:\Program Files\edb\as<version>\data, but this will vary according to local circumstances.)

Set all rows corresponding to settings that have not been documented and approved to have TYPE of 'hostssl' and METHOD of 'cert'."
  reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CCI|CCI-002420,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-109541r1_rule,STIG-ID|EP11-00-009500,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-100437"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*hostssl[\s]"
  expect      : "^[\s]*hostssl[\s].*[\s]cert([\s]|$)"
</custom_item>

<custom_item>
  type        : FILE_CONTENT_CHECK
  description : "EP11-00-009600 - The EDB Postgres Advanced Server must maintain the confidentiality and integrity of information during reception."
  info        : "Information can be either unintentionally or maliciously disclosed or modified during reception, including, for example, during aggregation, at protocol transformation points, and during packing/unpacking. These unauthorized disclosures or modifications compromise the confidentiality or integrity of the information.

This requirement applies only to those applications that are either distributed or can allow access to data nonlocally. Use of this requirement will be limited to situations where the data owner has a strict requirement for ensuring data integrity and confidentiality is maintained at every step of the data transfer and handling process.

When receiving data, the DBMS, associated applications, and infrastructure must leverage protection mechanisms."
  solution    : "Open '<postgresql data directory>\pg_hba.conf' in an editor. (The default path of the postgresql data directory for an EDB Postgres Advanced Server (EPAS) installation on Microsoft Windows is C:\Program Files\edb\as<version>\data, but this will vary according to local circumstances.)

Set all rows corresponding to settings that have not been documented and approved to have TYPE of 'hostssl' and METHOD of 'cert'."
  reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CCI|CCI-002422,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-109543r1_rule,STIG-ID|EP11-00-009600,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-100439"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*hostssl[\s]"
  expect      : "^[\s]*hostssl[\s].*[\s]cert([\s]|$)"
</custom_item>

<custom_item>
  type        : FILE_CONTENT_CHECK
  description : "EP11-00-012700 - The EDB Postgres Advanced Server must implement NIST FIPS 140-2 validated cryptographic modules to provision digital signatures. - hostssl"
  info        : "Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. The application must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance of testing and validation.

For detailed information, refer to NIST FIPS Publication 140-2, Security Requirements For Cryptographic Modules. Note that the product's cryptographic modules must be validated and certified by NIST as FIPS-compliant.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Edit <postgresql data dir>\pg_hba.conf so that each uncommented line starts with 'hostssl'.

If the EDB Postgres Advanced Server minor version is less than version 11.6, install the 11.6 update or later version or contact EnterpriseDB to obtain a copy of the FIPS 140-2 compliant versions of the 'ssleay32.dll' and 'libeay32.dll' files and replace the 'ssleay32.dll' and 'libeay32.dll' files in <EDB Postgres Advanced Server Home>\bin with FIPS 140-2 compliant DLLs from EnterpriseDB. If the EDB Postgres Advanced Server minor version is 11.6 or greater, the FIPS 140-2 compliant versions of these DLLs are installed by default and do not need to be replaced.

Create C:\usr\local\ssl\openssl.cnf or another file referenced by a System Environment variable called OPENSSL_CONF with these contents:

HOME = .
RANDFILE = $ENV::HOME/.rnd
openssl_conf=openssl_conf_section
[openssl_conf_section]
alg_section=evp_settings
[evp_settings]
fips_mode=yes

Restart the Postgres server via the Services administration GUI."
  reference   : "800-171|3.4.1,800-53|CM-8,CAT|II,CCI|CCI-002450,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,Rule-ID|SV-109607r1_rule,STIG-ID|EP11-00-012700,Vuln-ID|V-100503"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*hostssl[\s]"
  expect      : "^[\s]*hostssl[\s].*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-012700 - The EDB Postgres Advanced Server must implement NIST FIPS 140-2 validated cryptographic modules to provision digital signatures. - openssl_conf"
  info            : "Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. The application must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance of testing and validation.

For detailed information, refer to NIST FIPS Publication 140-2, Security Requirements For Cryptographic Modules. Note that the product's cryptographic modules must be validated and certified by NIST as FIPS-compliant."
  solution        : "Edit <postgresql data dir>\pg_hba.conf so that each uncommented line starts with 'hostssl'.

If the EDB Postgres Advanced Server minor version is less than version 11.6, install the 11.6 update or later version or contact EnterpriseDB to obtain a copy of the FIPS 140-2 compliant versions of the 'ssleay32.dll' and 'libeay32.dll' files and replace the 'ssleay32.dll' and 'libeay32.dll' files in <EDB Postgres Advanced Server Home>\bin with FIPS 140-2 compliant DLLs from EnterpriseDB. If the EDB Postgres Advanced Server minor version is 11.6 or greater, the FIPS 140-2 compliant versions of these DLLs are installed by default and do not need to be replaced.

Create C:\usr\local\ssl\openssl.cnf or another file referenced by a System Environment variable called OPENSSL_CONF with these contents:

HOME = .
RANDFILE = $ENV::HOME/.rnd
openssl_conf=openssl_conf_section
[openssl_conf_section]
alg_section=evp_settings
[evp_settings]
fips_mode=yes

Restart the Postgres server via the Services administration GUI."
  reference       : "800-171|3.4.1,800-53|CM-8,CAT|II,CCI|CCI-002450,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ISO/IEC-27001|A.8.1.1,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,Rule-ID|SV-109607r1_rule,STIG-ID|EP11-00-012700,Vuln-ID|V-100503"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : 'openssl_conf=openssl_conf_section'
  powershell_args : 'Get-Content \'C:\\usr\\local\\ssl\\openssl.cnf\' | where { $_.Contains(\\"openssl_conf\\") }'
  check_type      : CHECK_REGEX
</custom_item>

<custom_item>
  type        : FILE_CONTENT_CHECK
  description : "EP11-00-013200 - The EDB Postgres Advanced Server must be configured on a platform that has a NIST certified FIPS 140-2 installation of OpenSSL. - hostssl"
  info        : "Use of weak or not validated cryptographic algorithms undermines the purposes of utilizing encryption and digital signatures to protect data. Weak algorithms can be easily broken and not validated cryptographic modules may not implement algorithms correctly. Unapproved cryptographic modules or algorithms should not be relied on for authentication, confidentiality, or integrity. Weak cryptography could allow an attacker to gain access to and modify data stored in the database as well as the administration settings of the DBMS.

Applications, including DBMSs, utilizing cryptography are required to use approved NIST FIPS 140-2 validated cryptographic modules that meet the requirements of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

The security functions validated as part of FIPS 140-2 for cryptographic modules are described in FIPS 140-2 Annex A.

NSA Type-X (where X=1, 2, 3, 4) products are NSA-certified, hardware-based encryption modules.

Postgres uses OpenSSL for the underlying encryption layer. Organizations must obtain and use a FIPS 140-2 certified distribution of OpenSSL or build their own FIPS 140-2 OpenSSL libraries. EnterpriseDB has a FIPS 140-2 validated set of cryptographic modules for use with OpenSSL on Windows to meet this requirement for EDB Postgres Advanced Server deployments.

When the EDB FIPS 140-2 certified cryptographic modules are configured properly, an EDB Postgres Advanced Server will fail to start if non-FIPS 140-2 ciphers are specified for the Postgres ssl_ciphers parameter. To test whether the FIPS 140-2 compliant configuration is working, temporarily set the 'ssl_ciphers' parameter in the postgresql.conf file to 'RC4-SHA' and then attempt to restart the database service. Since 'RC4-SHA' is not a FIPS 140-2 approved cipher, the database will fail to start. On Windows, using the Event Viewer, a 'FATAL: could not set the cipher list (no valid ciphers available)' error will be found under 'Event Viewer (Local) >> Windows Logs >> Application'.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Edit <postgresql data dir>\pg_hba.conf so that each uncommented line starts with 'hostssl'.

If the EDB Postgres Advanced Server minor version is less than version 11.6, install the 11.6 update or later version or contact EnterpriseDB to obtain a copy of the FIPS 140-2 compliant versions of the 'ssleay32.dll' and 'libeay32.dll' files and replace the 'ssleay32.dll' and 'libeay32.dll' files in <EDB Postgres Advanced Server Home>\bin with FIPS 140-2 compliant DLLs from EnterpriseDB. If the EDB Postgres Advanced Server minor version is 11.6 or greater, the FIPS 140-2 compliant versions of these DLLs are installed by default and do not need to be replaced.

Create C:\usr\local\ssl\openssl.cnf or another file referenced by a System Environment variable called OPENSSL_CONF with these contents:

HOME = .
RANDFILE = $ENV::HOME/.rnd
openssl_conf=openssl_conf_section
[openssl_conf_section]
alg_section=evp_settings
[evp_settings]
fips_mode=yes

Restart the Postgres server via the Services administration GUI."
  reference   : "800-171|3.4.1,800-53|CM-8,CAT|II,CCI|CCI-000803,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,Rule-ID|SV-109617r1_rule,STIG-ID|EP11-00-013200,Vuln-ID|V-100513"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @PG_DATA_DIR@ replaced with "C:\\Program Files\\edb\\as11\\data" in field "value_data".
  value_data  : "C:\\Program Files\\edb\\as11\\data\pg_hba.conf"
  regex       : "^[\s]*hostssl[\s]"
  expect      : "^[\s]*hostssl[\s].*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "EP11-00-013200 - The EDB Postgres Advanced Server must be configured on a platform that has a NIST certified FIPS 140-2 installation of OpenSSL. - openssl_conf"
  info            : "Use of weak or not validated cryptographic algorithms undermines the purposes of utilizing encryption and digital signatures to protect data. Weak algorithms can be easily broken and not validated cryptographic modules may not implement algorithms correctly. Unapproved cryptographic modules or algorithms should not be relied on for authentication, confidentiality, or integrity. Weak cryptography could allow an attacker to gain access to and modify data stored in the database as well as the administration settings of the DBMS.

Applications, including DBMSs, utilizing cryptography are required to use approved NIST FIPS 140-2 validated cryptographic modules that meet the requirements of applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

The security functions validated as part of FIPS 140-2 for cryptographic modules are described in FIPS 140-2 Annex A.

NSA Type-X (where X=1, 2, 3, 4) products are NSA-certified, hardware-based encryption modules.

Postgres uses OpenSSL for the underlying encryption layer. Organizations must obtain and use a FIPS 140-2 certified distribution of OpenSSL or build their own FIPS 140-2 OpenSSL libraries. EnterpriseDB has a FIPS 140-2 validated set of cryptographic modules for use with OpenSSL on Windows to meet this requirement for EDB Postgres Advanced Server deployments.

When the EDB FIPS 140-2 certified cryptographic modules are configured properly, an EDB Postgres Advanced Server will fail to start if non-FIPS 140-2 ciphers are specified for the Postgres ssl_ciphers parameter. To test whether the FIPS 140-2 compliant configuration is working, temporarily set the 'ssl_ciphers' parameter in the postgresql.conf file to 'RC4-SHA' and then attempt to restart the database service. Since 'RC4-SHA' is not a FIPS 140-2 approved cipher, the database will fail to start. On Windows, using the Event Viewer, a 'FATAL: could not set the cipher list (no valid ciphers available)' error will be found under 'Event Viewer (Local) >> Windows Logs >> Application'."
  solution        : "Edit <postgresql data dir>\pg_hba.conf so that each uncommented line starts with 'hostssl'.

If the EDB Postgres Advanced Server minor version is less than version 11.6, install the 11.6 update or later version or contact EnterpriseDB to obtain a copy of the FIPS 140-2 compliant versions of the 'ssleay32.dll' and 'libeay32.dll' files and replace the 'ssleay32.dll' and 'libeay32.dll' files in <EDB Postgres Advanced Server Home>\bin with FIPS 140-2 compliant DLLs from EnterpriseDB. If the EDB Postgres Advanced Server minor version is 11.6 or greater, the FIPS 140-2 compliant versions of these DLLs are installed by default and do not need to be replaced.

Create C:\usr\local\ssl\openssl.cnf or another file referenced by a System Environment variable called OPENSSL_CONF with these contents:

HOME = .
RANDFILE = $ENV::HOME/.rnd
openssl_conf=openssl_conf_section
[openssl_conf_section]
alg_section=evp_settings
[evp_settings]
fips_mode=yes

Restart the Postgres server via the Services administration GUI."
  reference       : "800-171|3.4.1,800-53|CM-8,CAT|II,CCI|CCI-000803,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ISO/IEC-27001|A.8.1.1,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,Rule-ID|SV-109617r1_rule,STIG-ID|EP11-00-013200,Vuln-ID|V-100513"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_EDB_PGS_Advanced_Server_v11_Windows_V1R1_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : 'openssl_conf=openssl_conf_section'
  powershell_args : 'Get-Content \'C:\\usr\\local\\ssl\\openssl.cnf\' | where { $_.Contains(\\"openssl_conf\\") }'
  check_type      : CHECK_REGEX
</custom_item>

</group_policy>
</check_type>
